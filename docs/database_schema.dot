// Palearn Database Schema Diagram
// (2) ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
// ë Œë”ë§: dot -Tpng database_schema.dot -o database_schema.png

digraph PalearnDatabaseSchema {
    // ê·¸ë˜í”„ ì „ì—­ ì„¤ì •
    rankdir=LR;
    compound=true;
    fontname="Helvetica";
    fontsize=14;
    splines=ortho;
    nodesep=1.0;
    ranksep=1.5;

    // ë…¸ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼
    node [shape=none, fontname="Helvetica", fontsize=10];
    edge [fontname="Helvetica", fontsize=9];

    // ===== USERS í…Œì´ë¸” =====
    users [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#E3F2FD">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#1976D2"><FONT COLOR="white"><B>ğŸ‘¤ USERS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#BBDEFB"><B>Column</B></TD>
                <TD BGCOLOR="#BBDEFB"><B>Type</B></TD>
                <TD BGCOLOR="#BBDEFB"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”‘ user_id</TD>
                <TD>UUID (String)</TD>
                <TD ALIGN="LEFT">Primary Key - ì‚¬ìš©ì ê³ ìœ  ì‹ë³„ì</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">username</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ìëª… (ë¡œê·¸ì¸ ID)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">âœ‰ï¸ email</TD>
                <TD>String (Unique)</TD>
                <TD ALIGN="LEFT">ì´ë©”ì¼ ì£¼ì†Œ (ì¤‘ë³µ ë¶ˆê°€)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”’ password</TD>
                <TD>String (SHA256)</TD>
                <TD ALIGN="LEFT">ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°’</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">name</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ì ì‹¤ëª…</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“… birth</TD>
                <TD>String (YYYY-MM-DD)</TD>
                <TD ALIGN="LEFT">ìƒë…„ì›”ì¼</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“· photo_url</TD>
                <TD>String (Optional)</TD>
                <TD ALIGN="LEFT">í”„ë¡œí•„ ì‚¬ì§„ URL</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ·ï¸ friend_code</TD>
                <TD>String (8 chars)</TD>
                <TD ALIGN="LEFT">ì¹œêµ¬ ì¶”ê°€ìš© ê³ ìœ  ì½”ë“œ (MD5[:8])</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">â° created_at</TD>
                <TD>ISO Timestamp</TD>
                <TD ALIGN="LEFT">ê³„ì • ìƒì„± ì‹œê°</TD>
            </TR>
        </TABLE>
    >];

    // ===== PLANS í…Œì´ë¸” =====
    plans [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#E8F5E9">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#388E3C"><FONT COLOR="white"><B>ğŸ“š PLANS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#A5D6A7"><B>Column</B></TD>
                <TD BGCOLOR="#A5D6A7"><B>Type</B></TD>
                <TD BGCOLOR="#A5D6A7"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ì ì™¸ë˜í‚¤</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“‹ plan_name</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">í•™ìŠµ ê³„íšëª…</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">â±ï¸ total_duration</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ì´ í•™ìŠµ ê¸°ê°„ (ì˜ˆ: "4ì£¼")</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“† daily_schedule</TD>
                <TD>List[DailySchedule]</TD>
                <TD ALIGN="LEFT">ì¼ë³„ í•™ìŠµ ìŠ¤ì¼€ì¤„ ëª©ë¡</TD>
            </TR>
        </TABLE>
    >];

    // ===== DAILY_SCHEDULE í…Œì´ë¸” =====
    daily_schedule [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#FFF3E0">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#E65100"><FONT COLOR="white"><B>ğŸ“… DAILY_SCHEDULE</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#FFE0B2"><B>Column</B></TD>
                <TD BGCOLOR="#FFE0B2"><B>Type</B></TD>
                <TD BGCOLOR="#FFE0B2"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“† date</TD>
                <TD>String (YYYY-MM-DD)</TD>
                <TD ALIGN="LEFT">í•™ìŠµ ë‚ ì§œ</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“ tasks</TD>
                <TD>List[Task]</TD>
                <TD ALIGN="LEFT">í•´ë‹¹ ë‚ ì§œì˜ í•™ìŠµ ê³¼ì œ ëª©ë¡</TD>
            </TR>
        </TABLE>
    >];

    // ===== TASKS í…Œì´ë¸” =====
    tasks [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#FCE4EC">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#C2185B"><FONT COLOR="white"><B>âœ… TASKS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#F8BBD9"><B>Column</B></TD>
                <TD BGCOLOR="#F8BBD9"><B>Type</B></TD>
                <TD BGCOLOR="#F8BBD9"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”‘ id</TD>
                <TD>UUID (String)</TD>
                <TD ALIGN="LEFT">ê³¼ì œ ê³ ìœ  ì‹ë³„ì</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“Œ title</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">í•™ìŠµ ì£¼ì œ ì œëª©</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“ description</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ìƒì„¸ ì„¤ëª…</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">â±ï¸ duration</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ì˜ˆ: "1ì‹œê°„")</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">âœ“ completed</TD>
                <TD>Boolean</TD>
                <TD ALIGN="LEFT">ì™„ë£Œ ì—¬ë¶€ (ê¸°ë³¸: false)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“š related_materials</TD>
                <TD>List[Material]</TD>
                <TD ALIGN="LEFT">ê´€ë ¨ í•™ìŠµ ìë£Œ ëª©ë¡</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”„ review_materials</TD>
                <TD>List[Material]</TD>
                <TD ALIGN="LEFT">ë³µìŠµ ìë£Œ ëª©ë¡</TD>
            </TR>
        </TABLE>
    >];

    // ===== MATERIALS í…Œì´ë¸” =====
    materials [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#F3E5F5">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#7B1FA2"><FONT COLOR="white"><B>ğŸ“– MATERIALS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#E1BEE7"><B>Column</B></TD>
                <TD BGCOLOR="#E1BEE7"><B>Type</B></TD>
                <TD BGCOLOR="#E1BEE7"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“Œ title</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ìë£Œ ì œëª©</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— url</TD>
                <TD>String (URL)</TD>
                <TD ALIGN="LEFT">ìë£Œ ë§í¬</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ·ï¸ type</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ìë£Œ ìœ í˜• (youtube/blog/doc)</TD>
            </TR>
        </TABLE>
    >];

    // ===== FRIENDSHIPS í…Œì´ë¸” =====
    friendships [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#FFFDE7">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#F9A825"><FONT COLOR="white"><B>ğŸ‘¥ FRIENDSHIPS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#FFF9C4"><B>Column</B></TD>
                <TD BGCOLOR="#FFF9C4"><B>Type</B></TD>
                <TD BGCOLOR="#FFF9C4"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ì ì™¸ë˜í‚¤</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ‘¤ friend_ids</TD>
                <TD>List[UUID]</TD>
                <TD ALIGN="LEFT">ì¹œêµ¬ ì‚¬ìš©ì ID ëª©ë¡</TD>
            </TR>
        </TABLE>
    >];

    // ===== NOTIFICATIONS í…Œì´ë¸” =====
    notifications [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#E0F7FA">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#00838F"><FONT COLOR="white"><B>ğŸ”” NOTIFICATIONS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#B2EBF2"><B>Column</B></TD>
                <TD BGCOLOR="#B2EBF2"><B>Type</B></TD>
                <TD BGCOLOR="#B2EBF2"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ì ì™¸ë˜í‚¤</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ†• new</TD>
                <TD>List[String]</TD>
                <TD ALIGN="LEFT">ì½ì§€ ì•Šì€ ì•Œë¦¼ ë©”ì‹œì§€</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“­ old</TD>
                <TD>List[String]</TD>
                <TD ALIGN="LEFT">ì½ì€ ì•Œë¦¼ ë©”ì‹œì§€</TD>
            </TR>
        </TABLE>
    >];

    // ===== QUIZ_ANSWERS í…Œì´ë¸” =====
    quiz_answers [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#FFEBEE">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#D32F2F"><FONT COLOR="white"><B>â“ QUIZ_ANSWERS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#FFCDD2"><B>Column</B></TD>
                <TD BGCOLOR="#FFCDD2"><B>Type</B></TD>
                <TD BGCOLOR="#FFCDD2"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">ì‚¬ìš©ì ì™¸ë˜í‚¤</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ“‹ quiz_items</TD>
                <TD>List[QuizItem]</TD>
                <TD ALIGN="LEFT">í€´ì¦ˆ ë¬¸í•­ ëª©ë¡</TD>
            </TR>
        </TABLE>
    >];

    // ===== QUIZ_ITEM í…Œì´ë¸” =====
    quiz_item [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#FBE9E7">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#E64A19"><FONT COLOR="white"><B>ğŸ“ QUIZ_ITEM</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#FFCCBC"><B>Column</B></TD>
                <TD BGCOLOR="#FFCCBC"><B>Type</B></TD>
                <TD BGCOLOR="#FFCCBC"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”‘ id</TD>
                <TD>Integer</TD>
                <TD ALIGN="LEFT">ë¬¸í•­ ë²ˆí˜¸ (1-10)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">â” question</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">O/X í€´ì¦ˆ ì§ˆë¬¸</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">âœ“ answer</TD>
                <TD>Boolean</TD>
                <TD ALIGN="LEFT">ì •ë‹µ (true=O, false=X)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ’¡ explanation</TD>
                <TD>String</TD>
                <TD ALIGN="LEFT">ì •ë‹µ í•´ì„¤</TD>
            </TR>
        </TABLE>
    >];

    // ===== AUTH_TOKENS í…Œì´ë¸” =====
    auth_tokens [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#ECEFF1">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#455A64"><FONT COLOR="white"><B>ğŸ” AUTH_TOKENS</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#CFD8DC"><B>Column</B></TD>
                <TD BGCOLOR="#CFD8DC"><B>Type</B></TD>
                <TD BGCOLOR="#CFD8DC"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”‘ token</TD>
                <TD>UUID (String)</TD>
                <TD ALIGN="LEFT">ì¸ì¦ í† í° (Primary Key)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">í† í° ì†Œìœ ì</TD>
            </TR>
        </TABLE>
    >];

    // ===== FRIEND_CODES í…Œì´ë¸” =====
    friend_codes [label=<
        <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0" CELLPADDING="8" BGCOLOR="#E8EAF6">
            <TR>
                <TD COLSPAN="3" BGCOLOR="#3F51B5"><FONT COLOR="white"><B>ğŸ·ï¸ FRIEND_CODES</B></FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#C5CAE9"><B>Column</B></TD>
                <TD BGCOLOR="#C5CAE9"><B>Type</B></TD>
                <TD BGCOLOR="#C5CAE9"><B>Description</B></TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”‘ friend_code</TD>
                <TD>String (8 chars)</TD>
                <TD ALIGN="LEFT">ì¹œêµ¬ ì½”ë“œ (Primary Key)</TD>
            </TR>
            <TR>
                <TD ALIGN="LEFT">ğŸ”— user_id</TD>
                <TD>UUID (FK â†’ Users)</TD>
                <TD ALIGN="LEFT">ì½”ë“œ ì†Œìœ ì</TD>
            </TR>
        </TABLE>
    >];

    // ===== ê´€ê³„ ì •ì˜ =====

    // Users -> Plans (1:N)
    users:e -> plans:w [
        label="1:N\nhas many",
        color="#388E3C",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // Plans -> DailySchedule (1:N)
    plans:e -> daily_schedule:w [
        label="1:N\ncontains",
        color="#E65100",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // DailySchedule -> Tasks (1:N)
    daily_schedule:e -> tasks:w [
        label="1:N\nhas",
        color="#C2185B",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // Tasks -> Materials (1:N)
    tasks:e -> materials:w [
        label="1:N\nreferences",
        color="#7B1FA2",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // Users -> Friendships (1:1)
    users:s -> friendships:n [
        label="1:1",
        color="#F9A825",
        penwidth=2,
        arrowhead=normal
    ];

    // Users -> Notifications (1:1)
    users:s -> notifications:n [
        label="1:1",
        color="#00838F",
        penwidth=2,
        arrowhead=normal
    ];

    // Users -> QuizAnswers (1:N)
    users:s -> quiz_answers:n [
        label="1:N",
        color="#D32F2F",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // QuizAnswers -> QuizItem (1:N)
    quiz_answers:e -> quiz_item:w [
        label="1:N\ncontains",
        color="#E64A19",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // Users -> AuthTokens (1:N)
    users:s -> auth_tokens:n [
        label="1:N\ngenerates",
        color="#455A64",
        penwidth=2,
        arrowhead=crow,
        arrowtail=tee
    ];

    // Users -> FriendCodes (1:1)
    users:s -> friend_codes:n [
        label="1:1\nowns",
        color="#3F51B5",
        penwidth=2,
        arrowhead=normal
    ];

    // ===== ë²”ë¡€ =====
    subgraph cluster_legend {
        label="ë²”ë¡€ (Legend)";
        style="rounded,filled";
        fillcolor="#FAFAFA";
        fontsize=12;

        legend [label=<
            <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="8" CELLPADDING="4">
                <TR>
                    <TD COLSPAN="2"><B>Relationship Types</B></TD>
                </TR>
                <TR>
                    <TD>â”€â”€â”€â”€â”€â”€â”€â–º</TD>
                    <TD ALIGN="LEFT">1:1 ê´€ê³„ (One-to-One)</TD>
                </TR>
                <TR>
                    <TD>â”€â”€â”€â”€â”€â”€â”€â”€&lt;</TD>
                    <TD ALIGN="LEFT">1:N ê´€ê³„ (One-to-Many)</TD>
                </TR>
                <TR>
                    <TD COLSPAN="2"><B>Key Symbols</B></TD>
                </TR>
                <TR>
                    <TD>ğŸ”‘</TD>
                    <TD ALIGN="LEFT">Primary Key</TD>
                </TR>
                <TR>
                    <TD>ğŸ”—</TD>
                    <TD ALIGN="LEFT">Foreign Key</TD>
                </TR>
                <TR>
                    <TD COLSPAN="2"><B>Data Storage</B></TD>
                </TR>
                <TR>
                    <TD COLSPAN="2" ALIGN="LEFT">In-Memory Dictionary<BR/>(ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”)</TD>
                </TR>
            </TABLE>
        >];
    }

    // ë ˆì´ì•„ì›ƒ ì¡°ì •
    {rank=same; users;}
    {rank=same; plans; friendships; notifications; quiz_answers; auth_tokens; friend_codes;}
    {rank=same; daily_schedule; quiz_item;}
    {rank=same; tasks;}
    {rank=same; materials;}
}
